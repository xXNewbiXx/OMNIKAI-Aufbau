{
  "dashboard_config": {
    "name": "OMNIKAI Production Monitoring Dashboard (PostgreSQL)",
    "version": "1.0.0",
    "created_by": "FIX PACK",
    "created_date": "2025-08-09",
    "owner": "Claude-Flow",
    "approval_required": "BOSS (ChatGPT)",
    "refresh_interval_seconds": 30,
    "alert_escalation_enabled": true,
    "timezone": "Europe/Berlin"
  },
  "panels": [
    {
      "id": "system_health",
      "title": "System Health Overview",
      "type": "status_grid",
      "position": {
        "x": 0,
        "y": 0,
        "width": 12,
        "height": 4
      },
      "data_source": "omnikai_metrics_pg",
      "query": "SELECT status, uptime_percent FROM v_system_health_status",
      "refresh_interval": 30,
      "thresholds": {
        "critical": {
          "condition": "status = 'critical'"
        },
        "warning": {
          "condition": "status = 'warning'"
        },
        "healthy": {
          "condition": "status = 'healthy'"
        }
      },
      "metrics": [
        {
          "name": "System Uptime",
          "query": "SELECT uptime_percent FROM v_system_health WHERE component = 'core'",
          "unit": "%",
          "target": 99.5,
          "abort_threshold": 95.0
        },
        {
          "name": "API Response Time",
          "query": "SELECT avg_response_time_ms FROM v_api_performance",
          "unit": "ms",
          "target": 200,
          "abort_threshold": 1000
        },
        {
          "name": "Sebastian Horn Success Rate",
          "query": "SELECT success_rate_percent FROM v_agent_performance WHERE agent = 'Sebastian Horn'",
          "unit": "%",
          "target": 85,
          "abort_threshold": 70
        },
        {
          "name": "GDPR Compliance Score",
          "query": "SELECT compliance_rate_percent FROM v_compliance_kpis WHERE event_type = 'consent_verification' ORDER BY kpi_date DESC LIMIT 1",
          "unit": "%",
          "target": 99,
          "abort_threshold": 95
        }
      ]
    },
    {
      "id": "sales_performance",
      "title": "Sales Performance KPIs",
      "type": "metrics_chart",
      "position": {
        "x": 0,
        "y": 4,
        "width": 6,
        "height": 6
      },
      "data_source": "omnikai_metrics_pg",
      "chart_type": "line",
      "time_range": "24h",
      "metrics": [
        {
          "name": "Lead Generation Rate",
          "query": "SELECT date_trunc('hour', created_timestamp) AS time, COUNT(*) AS leads FROM sales_pipeline WHERE created_timestamp >= NOW() - INTERVAL '24 hours' GROUP BY 1 ORDER BY 1",
          "target": 10,
          "abort_threshold": 3
        },
        {
          "name": "Qualification Rate",
          "query": "SELECT date_trunc('hour', qualified_timestamp) AS time, COUNT(*) AS qualified FROM sales_pipeline WHERE qualified_timestamp IS NOT NULL AND qualified_timestamp >= NOW() - INTERVAL '24 hours' GROUP BY 1 ORDER BY 1",
          "target": 6,
          "abort_threshold": 1
        },
        {
          "name": "Meeting Conversion",
          "query": "SELECT date_trunc('hour', meeting_timestamp) AS time, COUNT(*) AS meetings FROM sales_pipeline WHERE meeting_timestamp IS NOT NULL AND meeting_timestamp >= NOW() - INTERVAL '24 hours' GROUP BY 1 ORDER BY 1",
          "target": 3,
          "abort_threshold": 0
        }
      ]
    },
    {
      "id": "compliance_monitoring",
      "title": "Compliance & Risk Monitoring",
      "type": "compliance_grid",
      "position": {
        "x": 6,
        "y": 4,
        "width": 6,
        "height": 6
      },
      "data_source": "omnikai_metrics_pg",
      "metrics": [
        {
          "name": "Data Transfer Gate Blocks",
          "query": "SELECT COUNT(*) AS blocks FROM compliance_events WHERE event_type = 'data_transfer' AND compliance_status = 'BLOCKED' AND event_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "count",
          "target": 0
        },
        {
          "name": "Consent Verification Rate",
          "query": "SELECT (COUNT(*) FILTER (WHERE compliance_status = 'COMPLIANT') * 100.0 / NULLIF(COUNT(*),0)) AS rate FROM compliance_events WHERE event_type = 'consent_verification' AND event_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "%",
          "target": 99
        },
        {
          "name": "DSAR Response Time",
          "query": "SELECT AVG(EXTRACT(EPOCH FROM (resolution_timestamp - event_timestamp)) / 3600.0) AS avg_hours FROM compliance_events WHERE event_type = 'dsar_request' AND resolution_timestamp IS NOT NULL AND event_timestamp >= NOW() - INTERVAL '7 days'",
          "unit": "hours",
          "target": 24
        },
        {
          "name": "Audit Log Completeness",
          "query": "SELECT (COUNT(*) * 100.0 / NULLIF((SELECT COUNT(*) FROM workflow_runs WHERE start_timestamp >= NOW() - INTERVAL '1 hour'),0)) AS completeness FROM compliance_events WHERE event_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "%",
          "target": 100
        }
      ]
    },
    {
      "id": "financial_metrics",
      "title": "Financial Performance",
      "type": "financial_dashboard",
      "position": {
        "x": 0,
        "y": 10,
        "width": 8,
        "height": 5
      },
      "data_source": "omnikai_metrics_pg",
      "time_range": "30d",
      "metrics": [
        {
          "name": "Monthly Recurring Revenue",
          "query": "SELECT SUM(amount_eur) AS mrr FROM financial_metrics WHERE metric_type = 'mrr' AND metric_date >= CURRENT_DATE - INTERVAL '30 days'",
          "unit": "EUR",
          "target": 50000
        },
        {
          "name": "Customer Acquisition Cost",
          "query": "SELECT AVG(cost_amount) AS cac FROM operation_costs WHERE operation_type = 'customer_acquisition' AND cost_timestamp >= NOW() - INTERVAL '30 days'",
          "unit": "EUR",
          "target": 5000,
          "direction": "lower_better"
        },
        {
          "name": "Gross Margin",
          "query": "SELECT gross_margin_percent FROM v_financial_kpis",
          "unit": "%",
          "target": 75
        },
        {
          "name": "Active Customers",
          "query": "SELECT COUNT(DISTINCT customer_id) AS active FROM financial_metrics WHERE metric_date >= CURRENT_DATE - INTERVAL '30 days'",
          "unit": "count",
          "target": 100
        }
      ]
    },
    {
      "id": "operational_performance",
      "title": "Operational Performance",
      "type": "operations_grid",
      "position": {
        "x": 0,
        "y": 15,
        "width": 12,
        "height": 4
      },
      "data_source": "omnikai_metrics_pg",
      "metrics": [
        {
          "name": "n8n Workflow Success Rate",
          "query": "SELECT (COUNT(*) FILTER (WHERE status = 'SUCCESS') * 100.0 / NULLIF(COUNT(*),0)) AS rate FROM workflow_runs WHERE start_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "%",
          "target": 98
        },
        {
          "name": "Average Execution Time",
          "query": "SELECT AVG(execution_time_ms) AS avg_time FROM workflow_runs WHERE status = 'SUCCESS' AND start_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "ms",
          "target": 2000
        },
        {
          "name": "Error Rate",
          "query": "SELECT (COUNT(*) FILTER (WHERE status = 'FAILED') * 100.0 / NULLIF(COUNT(*),0)) AS rate FROM workflow_runs WHERE start_timestamp >= NOW() - INTERVAL '1 hour'",
          "unit": "%",
          "target": 0
        },
        {
          "name": "Queue Depth",
          "query": "SELECT COUNT(*) AS depth FROM workflow_runs WHERE status = 'RUNNING'",
          "unit": "count",
          "target": 0
        }
      ]
    }
  ],
  "alerts": {
    "escalation_rules": [
      {
        "severity": "critical",
        "escalation_delay_minutes": 0,
        "recipients": [
          "claude-flow@omnikai.com",
          "boss@omnikai.com"
        ],
        "channels": [
          "email",
          "sms",
          "slack"
        ]
      },
      {
        "severity": "warning",
        "escalation_delay_minutes": 15,
        "recipients": [
          "operations@omnikai.com"
        ],
        "channels": [
          "email",
          "slack"
        ]
      }
    ],
    "abort_criteria": [
      {
        "name": "System Uptime Critical",
        "condition": "SELECT uptime_percent < 95 FROM v_system_health",
        "action": "immediate_escalation"
      },
      {
        "name": "GDPR Compliance Violation",
        "condition": "SELECT compliance_rate_percent < 95 FROM v_compliance_kpis ORDER BY kpi_date DESC LIMIT 1",
        "action": "compliance_team_alert"
      }
    ]
  }
}